apiVersion: build.openshift.io/v1
kind: BuildConfig
metadata:
  creationTimestamp: '2018-06-21T00:31:48Z'
  labels:
    app: jenkins-pipeline-example
    name: nodejs-ex-pipeline
    template: application-template-sample-pipeline
  name: sample-pipeline
  namespace: cicd-monolith-2de1
  resourceVersion: '219840217'
  selfLink: >-
    /apis/build.openshift.io/v1/namespaces/cicd-monolith-2de1/buildconfigs/sample-pipeline
  uid: 7c33216d-74ea-11e8-83d7-02722ccca8d2
spec:
  nodeSelector: null
  output: {}
  postCommit: {}
  resources: {}
  runPolicy: Serial
  source:
    type: None
  strategy:
    jenkinsPipelineStrategy:
      jenkinsfile: |-
        node('') {
          stage 'Atualiza a Build em Dev'
            openshiftBuild(namespace:'dev',buildConfig: 'node-js', showBuildLogs: 'true')
          stage 'Deploy em Dev'
            openshiftDeploy(namespace:'dev',deploymentConfig: 'node-js')
            openshiftScale(namespace:'dev',deploymentConfig: 'node-js',replicaCount: '5')
          stage 'Promove para Stage ?'
            input 'Proceeed ?'
          stage 'Atualiza a Build em Stage'
            openshiftBuild(namespace:'stage',buildConfig: 'node-js', showBuildLogs: 'true')
          stage 'Deploy em Stage'
            openshiftTag(namespace: 'stage', sourceStream: 'node-js',  sourceTag: 'latest', destinationStream: 'node-js', destinationTag: 'promoteToQA')
            openshiftDeploy(namespace:'stage',deploymentConfig: 'node-js')
            openshiftScale(namespace:'stage',deploymentConfig: 'node-js',replicaCount: '5')
          stage 'Promove para Produção ?'
            input 'Proceeed ?'
          stage 'Atualiza a Build em CI/CD'
            openshiftBuild(namespace:'cicd',buildConfig: 'node-js', showBuildLogs: 'true')
          stage 'Deploy em CI/CD'
            openshiftTag(namespace: 'cicd', sourceStream: 'node-js',  sourceTag: 'latest', destinationStream: 'node-js', destinationTag: 'promoteToProd')
            openshiftDeploy(namespace:'cicd',deploymentConfig: 'node-js')
            openshiftScale(namespace:'cicd',deploymentConfig: 'node-js',replicaCount: '5')            
        }
    type: JenkinsPipeline
  triggers:
    - github:
        secret: kH1HfX7p
      type: GitHub
    - generic:
        secret: kH1HfX7p
      type: Generic
status:
  lastVersion: 0
